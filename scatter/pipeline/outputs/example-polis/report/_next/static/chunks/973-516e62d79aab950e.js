"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[973],{3973:function(e,t,l){l.d(t,{Z:function(){return G}});var s=l(5893),n=l(7294);let a=["#8a2be2","#ff69b4","#1e90ff","#008080","#0000cd","#cdcd00","#ffa500","#ff0000","#008000","#ff4500","#32cd32","#ff1493","#9932cc","#20b2aa","#ff6347","#4169e1","#2e8b57","#8b4513","#7c2e69","#ffd700","#4b0082","#ff8c00","#dc143c","#556b2f"];var i=e=>{let t=(0,n.useMemo)(()=>{let t={};return e.forEach((e,l)=>{t[e]=a[l%a.length]}),t},[e]);return(0,n.useCallback)((e,l)=>l&&l!==e?"lightgray":t[e],[t])},r=l(6524);let o={Argument:"議論","Representative arguments":"代表的な議論","Open full-screen map":"全画面地図を開く","Back to report":"レポートに戻る","Hide labels":"ラベルを非表示にする","Show labels":"ラベルを表示","Show filters":"フィルターを表示","Hide filters":"フィルターを非表示","Min. votes":"最小投票数",Consensus:"コンセンサス",Showing:"表示中",arguments:"議論","Reset zoom":"ズームをリセット","Click anywhere on the map to close this":"このメッセージを閉じるには地図のどこかをクリックしてください","Click on the dot for details":"詳細を見るには点をクリックしてください",agree:"同意する",disagree:"同意しない",Language:"言語",English:"英語","of total":"合計",Overview:"分析結果の概要","Cluster analysis":"クラスター分析","Representative comments":"コメント例",Introduction:"導入",Clusters:"クラスター",Appendix:"付録","This report was generated using an AI pipeline that consists of the following steps":"このレポートは、以下のステップで構成されるAIパイプラインを使用して生成されました",Step:"ステップ",extraction:"抽出","show code":"コードを表示","hide code":"コードを非表示","show prompt":"プロンプトを表示","hide prompt":"プロンプトを非表示",embedding:"埋め込み",clustering:"クラスタリング",labelling:"ラベリング",takeaways:"まとめ",overview:"概要"};var c=(e,t,l)=>{let[s,a]=(0,n.useState)(0),i=(0,n.useMemo)(()=>{let t=null==e?void 0:e.translation,l=(null==t?void 0:t.languages)||[],s=(null==t?void 0:t.flags)||[];return[{name:"English",flag:"US"},...l.map((e,t)=>({name:e,flag:s[t]}))]},[]);(0,n.useMemo)(()=>"TW"===i[s].flag?r.dS({from:"cn",to:"twp"}):e=>e,[i[s].flag]);let{replaceAll:c,manualChanges:d}=(0,n.useMemo)(()=>{var t;let s={},n=(null==e?void 0:null===(t=e.visualization)||void 0===t?void 0:t.replacements)||[],a=[],i=!0,r=e=>{if(0===n.length)return e;if(s[e])return s[e];let t=e;return n.forEach(e=>{let{replace:l,by:s}=e;t=t.split(l).join(s)}),i&&t!==e&&a.push({from:e,to:t}),s[e]=t,t};return l.forEach(e=>{r(e.cluster),r(e.takeaways||""),e.arguments.forEach(e=>{r(e.argument)})}),i=!1,{replaceAll:r,manualChanges:a}},[s]),u=(0,n.useCallback)(e=>e&&o[e]||e,[s,c]);return{languages:i,setLangIndex:a,langIndex:s,t:u,manualChanges:d}};let d=e=>{let{className:t}=e;return(0,s.jsx)("svg",{className:t,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.633 10.5c.806 0 1.533-.446 2.031-1.08a9.041 9.041 0 012.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 00.322-1.672V3a.75.75 0 01.75-.75A2.25 2.25 0 0116.5 4.5c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 01-2.649 7.521c-.388.482-.987.729-1.605.729H13.48c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 00-1.423-.23H5.904M14.25 9h2.25M5.904 18.75c.083.205.173.405.27.602.197.4-.078.898-.523.898h-.908c-.889 0-1.713-.518-1.972-1.368a12 12 0 01-.521-3.507c0-1.553.295-3.036.831-4.398C3.387 10.203 4.167 9.75 5 9.75h1.053c.472 0 .745.556.5.96a8.958 8.958 0 00-1.302 4.665c0 1.194.232 2.333.654 3.375z"})})},u=e=>{let{className:t}=e;return(0,s.jsx)("svg",{className:t,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 15h2.25m8.024-9.75c.011.05.028.1.052.148.591 1.2.924 2.55.924 3.977a8.96 8.96 0 01-.999 4.125m.023-8.25c-.076-.365.183-.75.575-.75h.908c.889 0 1.713.518 1.972 1.368.339 1.11.521 2.287.521 3.507 0 1.553-.295 3.036-.831 4.398C20.613 14.547 19.833 15 19 15h-1.053c-.472 0-.745-.556-.5-.96a8.95 8.95 0 00.303-.54m.023-8.25H16.48a4.5 4.5 0 01-1.423-.23l-3.114-1.04a4.5 4.5 0 00-1.423-.23H6.504c-.618 0-1.217.247-1.605.729A11.95 11.95 0 002.25 12c0 .434.023.863.068 1.285C2.427 14.306 3.346 15 4.372 15h3.126c.618 0 .991.724.725 1.282A7.471 7.471 0 007.5 19.5a2.25 2.25 0 002.25 2.25.75.75 0 00.75-.75v-.633c0-.573.11-1.14.322-1.672.304-.76.93-1.33 1.653-1.715a9.04 9.04 0 002.86-2.4c.498-.634 1.226-1.08 2.032-1.08h.384"})})};var m=e=>{let{video:t,timestamp:l,interview:n,showThumbnail:a,showVideo:i}=e;if(!t||!l||!n)return null;if(!t.includes("vimeo.com"))return console.error("Only Vimeo videos are supported at this time."),!1;let r=t.split("/"),o=r[r.length-1],[c,d,u]=l.split(":").map(Number);return(0,s.jsxs)("div",{className:"my-4",children:[(a||i)&&(0,s.jsx)("div",{className:"text-sm font-semibold mb-1",children:"Source video:"}),a&&(0,s.jsx)("img",{className:"mt-2",width:"320",height:"240",src:"https://vumbnail.com/".concat(o,".jpg"),alt:""}),i&&(0,s.jsx)("iframe",{src:"https://player.vimeo.com/video/".concat(o,"#t=").concat(3600*c+60*d+u,"s"),width:"320",height:"240",allow:"autoplay; fullscreen; picture-in-picture"})]})},h=e=>{let{point:t,dimensions:l,expanded:n,zoom:a,fullScreen:i,translator:r}=e,{scaleX:o,scaleY:c,width:h,height:x}=l,{zoomX:g,zoomY:p}=a,{t:f}=r,v=g(o(t.x)),j=p(c(t.y)),b={};if(i)b=n?{position:"absolute",left:v>h/2?void 0:v,right:v>h/2?h-v:void 0,top:0,maxWidth:h/1.3,maxHeight:x/2,overflowY:"auto",zIndex:10}:{position:"absolute",left:v>h/2?void 0:v,right:v>h/2?h-v:void 0,top:j>x/2?void 0:j,bottom:j>x/2?x-j:void 0,maxWidth:h/1.3,maxHeight:x/2,overflowY:"auto",pointerEvents:"none",zIndex:10};else{let e=v-150,t=j+20;e<0&&(e=0),e+300>h&&(e=h-300),t+200>x&&(t=j-200-20),b={position:"absolute",left:e,top:t,width:"".concat(300,"px"),overflowY:"auto",zIndex:10}}return(0,s.jsxs)("div",{className:"text-left p-4 shadow-sm transition-all duration-300 break-words overflow-y-auto bg-white rounded-md",style:{...b,backgroundColor:"#f0f0f0"},children:[(0,s.jsx)("div",{className:"font-bold text-base md:text-lg",style:{color:t.color},children:f(t.cluster)}),(0,s.jsx)("div",{className:"my-2 text-sm md:text-md",children:f(t.argument)}),(t.agrees||t.disagrees)&&(0,s.jsxs)("div",{className:"text-xs opacity-80 mb-2 font-bold",children:[(0,s.jsx)(d,{className:"w-4 inline-block"})," ",t.agrees,(0,s.jsx)(u,{className:"w-4 inline-block ml-3"})," ",t.disagrees]}),(0,s.jsx)(m,{...t,showVideo:!1,showThumbnail:!n})]})};let x=(e,t,l)=>{console.log("getDimensions",window.innerWidth);let s=window.innerWidth<500?{width:window.innerWidth-100,height:window.innerWidth-100,padding:10}:{width:e||window.innerWidth,height:t||window.innerHeight,padding:l||30};return console.log(s),{...s,scaleX:e=>s.padding+e*(s.width-2*s.padding),scaleY:e=>s.padding+e*(s.height-2*s.padding)}};var g=(e,t,l)=>{let[s,a]=(0,n.useState)(x(e,t,l));return(0,n.useEffect)(()=>{let s=()=>{a(x(e,t,l))};return window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}},[]),s},p=e=>{let t=e.map(e=>e.arguments).flat(),l=t.map(e=>e.x),s=t.map(e=>e.y),n=Math.min(...l),a=Math.min(...s),i=Math.max(...l),r=Math.max(...s);return e.map(e=>{let t=e.arguments.map(e=>{let t=(e.x-n)/(i-n),l=(e.y-a)/(r-a);return{...e,x:t,y:l}});return{...e,arguments:t}})},f=l(8294),v=function(e,t,l,s,a,i){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:30;return(0,n.useMemo)(()=>{if(!a)return()=>null;let{width:n,height:o,scaleX:c,scaleY:d}=a,u=e.flatMap(e=>e.arguments.map(s=>({...s,...e,...t[s.comment_id],color:l(e.cluster_id)}))),m=(0,f.Z)({x:e=>c(e.x),y:e=>d(e.y),width:n,height:o})(u);return e=>{let t=e.target.getBoundingClientRect(),l=s.unZoomX(e.clientX-t.left),n=s.unZoomY(e.clientY-t.top),a=m.find(l,n,r);return i&&a&&a.data.cluster_id!==i?null:a}},[e,a])},j=e=>(0,n.useMemo)(()=>{var t;let{config:l,comments:s}=e,n=s[Object.keys(s)[0]],a=(null===(t=l.translation)||void 0===t?void 0:t.languages)||[];return{dataHasVotes:n.hasOwnProperty("agrees"),hasTranslations:a.length>0}},[]),b=(e,t)=>{let[l,s]=(0,n.useState)({scale:1,panx:0,pany:0}),[a,i]=(0,n.useState)(!1),[r,o]=(0,n.useState)({x:0,y:0}),[c,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),h=e=>{if(!t||u)return;let n=e.target.getBoundingClientRect(),a=e.clientX-n.left,i=e.clientY-n.top,r=Math.max(.2,Math.min(5,l.scale-e.deltaY/1e3)),o=a-(a-l.panx)*(r/l.scale),c=i-(i-l.pany)*(r/l.scale);s({scale:r,panx:o,pany:c})},x=e=>{if(!t||u)return;let l=e.target.getBoundingClientRect(),s=e.clientX-l.left,n=e.clientY-l.top;i(!0),o({x:s,y:n}),d(!1)},g=(e,n)=>i=>{if(e(i),!t||u||!a)return;n();let c=i.target.getBoundingClientRect(),m=i.clientX-c.left,h=i.clientY-c.top,x=l.panx+(m-r.x),g=l.pany+(h-r.y);o({x:m,y:h}),d(!0),s({...l,panx:x,pany:g})},p=e=>t=>{c||e(t),i(!1)},f=(1!=l.scale||0!=l.panx||0!=l.pany)&&(()=>{s({scale:1,panx:0,pany:0})});return{...l,events:e=>{let{onMove:t,onDrag:l,onClick:s}=e;return{onWheel:h,onMouseDown:x,onMouseMove:g(t,l),onMouseUp:p(s)}},dragging:a,zoomX:e=>e*l.scale+l.panx,zoomY:e=>e*l.scale+l.pany,unZoomX:e=>(e-l.panx)/l.scale,unZoomY:e=>(e-l.pany)/l.scale,reset:f,disable:()=>m(!0),enable:()=>m(!1)}},w=(e,t,l,s,a)=>{let i=(0,n.useCallback)(e=>{if(!a)return!0;let n=t[e.comment_id],i=n.agrees+n.disagrees,r=100*Math.max(n.agrees,n.disagrees)/i;return i>=l&&r>=s},[l,s]),r=(0,n.useMemo)(()=>{let t=0,l=0;return e.forEach(e=>e.arguments.forEach(e=>{t++,!i(e)&&l++})),{total:t,filtered:l}},[i]);return{filter:i,...r}};let y=e=>e.reduce((e,t)=>e+t,0)/e.length,N=()=>"ontouchstart"in window||navigator.maxTouchPoints>0;var k=l(6008),S=l(9008),C=l.n(S),_=e=>{let{config:t}=e,l=t.name;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(C(),{children:(0,s.jsx)("title",{children:l})})})},M=function(e){let{fullScreen:t,back:l,onlyCluster:a,comments:i,translator:r,color:o,config:c}=e,{dataHasVotes:d}=j(e),u=g(e.width,e.height),m=p(e.clusters),x=b(u,t),f=v(m,e.comments,o,x,u,a),[S,C]=(0,n.useState)(null),[M,z]=(0,n.useState)(!1),[I,T]=(0,n.useState)(!0),[E,Y]=(0,n.useState)(!1),[X,R]=(0,n.useState)(0),[H,O]=(0,n.useState)(50),L=w(m,i,X,H,d),{scaleX:W,scaleY:B,width:A,height:F}=u||{},{t:V}=r,[D,Z]=(0,n.useState)(!1);if((0,n.useEffect)(()=>{Z(N())},[]),!u)return console.log("NO DIMENSIONS???"),(0,s.jsx)("div",{className:"m-auto bg-blue-50",style:{width:e.width,height:e.height}});let[G,P]=(0,n.useState)({scale:1,x:0,y:0}),q=(0,k.T2)({onDrag:e=>{let{offset:[t,l],memo:s}=e;return P(e=>({...e,x:t,y:l})),s},onPinch:e=>{let{offset:[t],memo:l}=e;return P(e=>({...e,scale:t})),l}});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(_,{config:c}),(0,s.jsxs)("div",{className:"m-auto relative",style:{width:A,height:F,overflow:t?"hidden":"visible",backgroundColor:"#dcdcdc"},onMouseLeave:()=>{M||C(null)},children:[(0,s.jsx)("svg",{width:A,height:F,...q(),...x.events({onClick:e=>{if(S&&!M)z(!0),x.disable();else{var t;z(!1),C((null===(t=f(e))||void 0===t?void 0:t.data)||null),x.enable()}},onMove:e=>{if(!M){var t;C((null===(t=f(e))||void 0===t?void 0:t.data)||null)}},onDrag:()=>{C(null)}}),children:m.map(e=>e.arguments.filter(L.filter).map(t=>{let{arg_id:l,x:n,y:i}=t;return(0,s.jsx)("circle",{className:"pointer-events-none",id:l,cx:x.zoomX(W(n))+8,cy:x.zoomY(B(i)),fill:o(e.cluster_id,a),opacity:M&&(null==S?void 0:S.arg_id)!==l?.3:1,r:(null==S?void 0:S.arg_id)===l?8:4},l)}))}),t&&I&&!x.dragging&&!N()&&(0,s.jsx)("div",{children:m.map(e=>(0,s.jsx)("div",{className:"absolute opacity-90 bg-white p-2 max-w-lg rounded-lg pointer-events-none select-none transition-opacity duration-300 font-bold ".concat(D?"text-base":"text-2xl"),style:{transform:"translate(-50%, -50%)",left:x.zoomX(W(y(e.arguments.map(e=>{let{x:t}=e;return t})))),top:x.zoomY(B(y(e.arguments.map(e=>{let{y:t}=e;return t})))),color:o(e.cluster_id,a),opacity:M?.3:(null==S?void 0:S.cluster_id)===e.cluster_id?0:.85},children:V(e.cluster)},e.cluster_id))}),S&&(0,s.jsx)(h,{point:S,dimensions:u,zoom:x,expanded:M,fullScreen:t,translator:r}),t&&(0,s.jsxs)("div",{className:"absolute top-0 left-0",children:[(0,s.jsx)("button",{className:"m-2 underline",onClick:l,children:V("Back to report")}),(0,s.jsx)("button",{className:"m-2 underline",onClick:()=>T(e=>!e),children:I?V("Hide labels"):V("Show labels")}),x.reset&&(0,s.jsx)("button",{className:"m-2 underline",onClick:x.reset,children:V("Reset zoom")}),d&&(0,s.jsx)("button",{className:"m-2 underline",onClick:()=>{Y(e=>!e)},children:E?V("Hide filters"):V("Show filters")}),E&&(0,s.jsxs)("div",{className:"absolute w-[400px] top-12 left-2 p-2 border bg-white rounded leading-4",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("button",{className:"inline-block m-2 text-left",children:[V("Votes")," ",">"," ",(0,s.jsx)("span",{className:"inline-block w-10",children:X})]}),(0,s.jsx)("input",{className:"inline-block w-[200px] mr-2",id:"min-votes-slider",type:"range",min:"0",max:"50",value:X,onInput:e=>{R(parseInt(e.target.value))}})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("button",{className:"inline-block m-2 text-left",children:[V("Consensus")," ",">"," ",(0,s.jsxs)("span",{className:"inline-block w-10",children:[H,"%"]})]}),(0,s.jsx)("input",{className:"inline-block w-[200px] mr-2",id:"min-consensus-slider",type:"range",min:"50",max:"100",value:H,onInput:e=>{O(parseInt(e.target.value))}})]}),(0,s.jsxs)("div",{className:"text-sm ml-2 mt-2 opacity-70",children:[V("Showing")," ",L.filtered,"/",L.total," ",V("arguments")]})]})]})]})]})},z=l(9603),I=l(9417),T=l(4288),E=function(e){let{point:t,expanded:l,position:n,onClose:a,isFavorite:i,onToggleFavorite:r,colorFunc:o,translator:c,isTouch:d}=e,{t:u}=c,m=d?{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",background:"rgba(255, 255, 255, 0.95)",padding:"15px",borderRadius:"8px",maxWidth:"300px",zIndex:1e3}:l?{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",background:"rgba(255, 255, 255, 0.95)",padding:"20px",borderRadius:"8px",maxWidth:"600px",zIndex:1e3}:{position:"absolute",left:n.x,top:n.y,transform:"translate(10px, -10px)",background:"rgba(255, 255, 255, 0.9)",padding:"10px",borderRadius:"4px",maxWidth:"300px",zIndex:1e3,pointerEvents:"none"};return(0,s.jsxs)(s.Fragment,{children:[!d&&l&&(0,s.jsx)("div",{onClick:a,style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",zIndex:999}}),(0,s.jsxs)("div",{style:m,children:[l&&!d&&(0,s.jsx)("button",{onClick:a,style:{float:"right"},children:u("Close")}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,s.jsx)("h3",{style:{color:o(t.cluster_id),margin:0},className:"text-base sm:text-base md:text-base font-bold",children:c.t(t.cluster)}),(0,s.jsx)("button",{onClick:()=>r(),className:"text-amber-500 text-lg focus:outline-none ml-2","aria-label":u(i?"お気に入りから削除":"お気に入りに追加"),style:{marginLeft:"8px"},children:(0,s.jsx)(z.G,{icon:i?I.xVw:T.xVw})})]}),(0,s.jsx)("p",{className:"text-sm sm:text-sm md:text-md mt-2",children:t.argument})]})]})},Y=l(4751);let X=(e,t)=>e.length<=t?e:e.slice(0,t)+"...";var R=function(e){let{fullScreen:t=!1,back:l,onlyCluster:a,comments:i,translator:r,color:o,config:c}=e,{dataHasVotes:d}=j(e),u=g(e.width,e.height),m=p(e.clusters),h=b(u,t),x=v(m,e.comments,o,h,u,a),[f,k]=(0,n.useState)(null),[S,C]=(0,n.useState)({x:0,y:0}),[M,T]=(0,n.useState)(!1),[R,H]=(0,n.useState)(!0),[O,L]=(0,n.useState)(!1),[W,B]=(0,n.useState)(!1),[A,F]=(0,n.useState)(!1),[V,D]=(0,n.useState)(!1),[Z,G]=(0,n.useState)(0),[P,q]=(0,n.useState)(50),J=w(m,i,Z,P,d),U=m.map(e=>e.arguments.length).reduce((e,t)=>e+t,0),{scaleX:K,scaleY:Q,width:$,height:ee}=u||{},{t:et}=r,[el,es]=(0,n.useState)(!1),en="favorites_".concat(window.location.href),[ea,ei]=(0,n.useState)(()=>{try{let e=localStorage.getItem(en);return console.log("読み込んだお気に入り:",e),e?JSON.parse(e):[]}catch(e){return console.error("お気に入りの読み込みに失敗しました:",e),[]}});(0,n.useEffect)(()=>{try{localStorage.setItem(en,JSON.stringify(ea)),console.log("保存したお気に入り:",ea)}catch(e){console.error("お気に入りの保存に失敗しました:",e)}},[ea]),(0,n.useEffect)(()=>{es(N())},[]);let er=(0,n.useRef)(null),eo=(e,t)=>{if(el&&u)return{x:$/2,y:ee/2};if(er.current){let l=er.current.getBoundingClientRect(),s=e-l.left,n=t-l.top,a=l.width;return s+200>a&&(s=a-200-10),s<10&&(s=10),{x:s,y:n}}return console.warn("containerRef.current is undefined"),{x:0,y:0}};if(!u)return console.log("NO DIMENSIONS???"),(0,s.jsx)("div",{className:"m-auto bg-blue-50",style:{width:e.width,height:e.height}});let[ec,ed]=(0,n.useState)({scale:1,x:0,y:0}),[eu,em]=(0,n.useState)(!0),eh=e=>{ei(t=>t.some(t=>t.arg_id===e.arg_id)?t.filter(t=>t.arg_id!==e.arg_id):[...t,e])},ex=e=>{console.log("handleTap called");let t=e.clientX,l=e.clientY;console.log("Tap event at (".concat(t,", ").concat(l,")"));let s=x({clientX:t,clientY:l});if(s){let e=eo(t,l);console.log("Tapped point found:",s.data),k(s.data),C(e)}else f&&(k(null),console.log("Tooltip closed due to tap with no point"))},eg=(0,Y.useGesture)({onDrag:e=>{let{movement:[t,l],cancel:s,direction:[n,a],distance:i,memo:r}=e;return eu&&(Math.abs(a)>Math.abs(n)?s():ed(e=>({...e,x:e.x+t,y:e.y+l}))),r},onPinch:e=>{let{offset:[t],memo:l}=e,s=Math.min(Math.max(t,.5),4);return ed(e=>({...e,scale:s})),l},onClick:e=>{let{event:t}=e;ex(t)}},{drag:{filterTaps:!0,threshold:5},pinch:{scaleBounds:{min:.5,max:4}}});(0,n.useEffect)(()=>{if(0===m.length)return;let e=m.flatMap(e=>e.arguments.map(e=>e.x)),l=m.flatMap(e=>e.arguments.map(e=>e.y)),s=Math.min(...e),n=Math.min(...l),a=Math.max(...e)-s,i=Math.max(...l)-n;if(!u)return;let{width:r,height:o}=u,c=t?.75*r:r,d=t?.6:.8,h=Math.min(c*d/a,o*d/i);t&&(h*=.8);let x=(c-a*h)/2-s*h,g=(o-i*h)/2-n*h;ed({scale:h,x,y:g})},[m,u,t]);let ep=function(e){let t=e.match(/＜([^＞]+)＞(?:.*?＜([^＞]+)＞)?/);if(t){let e=t[1],l="";if(t[2]){let e=t[2].match(/（([^）]+)）/);l=e?"（".concat(e[1],"）"):"（".concat(t[2],"）")}return"＜".concat(e,"に関する分析結果").concat(l,"＞")}return null}(c.name);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(_,{config:c}),(0,s.jsxs)("div",{className:"flex flex-1",children:[(0,s.jsxs)("div",{ref:er,className:"relative flex-grow",style:{height:t?"100vh":"".concat(ee,"px"),overflow:t?"hidden":"visible",backgroundColor:"#dcdcdc"},onMouseLeave:()=>{M||k(null)},children:[V&&t&&(0,s.jsx)("div",{className:"absolute top-12 left-1/2 transform -translate-x-1/2 z-10 bg-white px-4 py-2 rounded-lg shadow-md",style:{opacity:M?.3:.85,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:(0,s.jsx)("h2",{className:"text-3xl font-bold",children:ep})}),(0,s.jsxs)("svg",{width:$,height:ee,...eg(),...h.events({onClick:e=>{if(console.log("handleClick called"),el){let t,l;e.touches&&e.touches.length>0?(t=e.touches[0].clientX,l=e.touches[0].clientY):e.changedTouches&&e.changedTouches.length>0?(t=e.changedTouches[0].clientX,l=e.changedTouches[0].clientY):(t=e.clientX,l=e.clientY);let s=x({clientX:t,clientY:l});if(s){let e=eo(t,l);console.log("Clicked point found:",s.data),k(s.data),C(e)}else console.log("No point found at the clicked position"),k(null)}else if(f&&!M)T(!0),console.log("Tooltip expanded");else if(M)T(!1),k(null),console.log("Tooltip collapsed");else{let t=x(e);if(t){let l=eo(e.clientX,e.clientY);console.log("Clicked point found:",t.data),k(t.data),C(l)}else console.log("No point found at the clicked position"),k(null)}},onMove:e=>{if(!M){let t=x(e);if(t){let l=eo(e.clientX,e.clientY);k(t.data),C(l)}else k(null)}},onDrag:()=>{k(null)}}),children:[m.map(e=>e.arguments.filter(J.filter).map(t=>{let{arg_id:l,x:n,y:i}=t;return(0,s.jsx)("circle",{className:"pointer-events-none",id:l,cx:h.zoomX(K(n)+20),cy:h.zoomY(Q(i)),fill:o(e.cluster_id,a),opacity:M&&(null==f?void 0:f.arg_id)!==l?.3:1,r:(null==f?void 0:f.arg_id)===l?8:4},l)})),W&&ea.map(e=>(0,s.jsx)("circle",{cx:h.zoomX(K(e.x)),cy:h.zoomY(Q(e.y)),fill:"gold",r:6},e.arg_id))]}),t&&R&&!h.dragging&&!N()&&(0,s.jsx)("div",{children:m.map(e=>(0,s.jsxs)("div",{className:"absolute opacity-90 bg-white p-2 max-w-lg rounded-lg pointer-events-none select-none transition-opacity duration-300 font-bold ".concat(el?"text-base":"text-md"),style:{transform:"translate(-50%, -50%)",left:h.zoomX(K(y(e.arguments.map(e=>{let{x:t}=e;return t})))),top:h.zoomY(Q(y(e.arguments.map(e=>{let{y:t}=e;return t})))),color:o(e.cluster_id,a),opacity:M?.3:(null==f?void 0:f.cluster_id)===e.cluster_id?0:.85},children:[et(e.cluster),O&&(0,s.jsxs)("span",{children:["(",Math.round(100*e.arguments.length/U),"%)"]})]},e.cluster_id))}),f&&(0,s.jsx)(E,{point:f,dimensions:u,zoom:h,expanded:M,fullScreen:t,translator:r,isFavorite:ea.some(e=>e.arg_id===f.arg_id),onToggleFavorite:()=>eh({arg_id:f.arg_id,argument:f.argument,comment_id:f.comment_id,x:f.x,y:f.y,p:f.p,cluster_id:f.cluster_id}),colorFunc:o,position:S,onClose:()=>{k(null),T(!1)},isTouch:el}),t&&(0,s.jsxs)("div",{className:"absolute top-0 left-0",children:[(0,s.jsx)("button",{className:"m-2 underline",onClick:l,children:et("Back to report")}),(0,s.jsx)("button",{className:"m-2 underline",onClick:()=>H(e=>!e),children:R?et("Hide labels"):et("Show labels")}),(0,s.jsx)("button",{className:"m-2 underline",onClick:()=>B(e=>!e),children:W?et("お気に入りを非表示"):et("お気に入りを表示")}),(0,s.jsx)("button",{className:"m-2 underline",onClick:()=>D(e=>!e),children:V?et("タイトルを非表示"):et("タイトルを表示")}),(0,s.jsx)("button",{className:"m-2 underline",onClick:()=>L(e=>!e),children:O?et("割合を非表示"):et("割合を表示")}),h.reset&&(0,s.jsx)("button",{className:"m-2 underline",onClick:h.reset,children:et("Reset zoom")}),d&&(0,s.jsx)("button",{className:"m-2 underline",onClick:()=>{F(e=>!e)},children:A?et("Hide filters"):et("Show filters")}),A&&(0,s.jsxs)("div",{className:"absolute w-[400px] top-12 left-2 p-2 border bg-white rounded leading-4",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("button",{className:"inline-block m-2 text-left",children:[et("Votes")," ",">"," ",(0,s.jsx)("span",{className:"inline-block w-10",children:Z})]}),(0,s.jsx)("input",{className:"inline-block w-[200px] mr-2",id:"min-votes-slider",type:"range",min:"0",max:"50",value:Z,onInput:e=>{G(parseInt(e.target.value))}})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("button",{className:"inline-block m-2 text-left",children:[et("Consensus")," ",">"," ",(0,s.jsxs)("span",{className:"inline-block w-10",children:[P,"%"]})]}),(0,s.jsx)("input",{className:"inline-block w-[200px] mr-2",id:"min-consensus-slider",type:"range",min:"50",max:"100",value:P,onInput:e=>{q(parseInt(e.target.value))}})]}),(0,s.jsxs)("div",{className:"text-sm ml-2 mt-2 opacity-70",children:[et("Showing")," ",J.filtered,"/",J.total," ",et("arguments")]})]})]})]}),(!t||W)&&(0,s.jsxs)("div",{className:"w-1/4 p-4 bg-gray-100 overflow-y-auto",style:{height:t?"100vh":"".concat(ee,"px")},children:[(0,s.jsx)("h2",{className:"text-md font-bold mb-4",children:r.t("お気に入り一覧")}),0===ea.length?(0,s.jsx)("p",{children:r.t("お気に入りがありません")}):(0,s.jsx)("ul",{children:ea.map(e=>{let t=m.find(t=>t.cluster_id===e.cluster_id);return(0,s.jsxs)("li",{className:"mb-2 p-2 bg-white rounded shadow flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"font-semibold text-md",style:{color:t?o(t.cluster_id,a):"#000"},children:r.t((null==t?void 0:t.cluster)||"クラスタ")}),(0,s.jsx)("button",{onClick:()=>eh(e),className:"text-amber-500 text-lg focus:outline-none ml-2",children:(0,s.jsx)(z.G,{icon:I.xVw})})]}),(0,s.jsx)("p",{className:"text-md text-gray-700 mt-1",children:X(e.argument,100)})]},e.arg_id)})})]})]})]})},H=e=>{let{config:t}=e,{t:l,languages:n,langIndex:a,setLangIndex:i}=e.translator,{hasTranslations:r}=j(e);return(0,s.jsx)("div",{className:"fixed top-0 w-full h-7 bg-gradient-to-r from-blue-900 to-white z-10 leading-7",children:(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("div",{className:"text-white mx-2",children:"Talk to the City"}),r&&(0,s.jsx)("div",{children:n.map((e,t)=>(0,s.jsx)("button",{className:"text-white mx-2",style:{opacity:a===t?1:.7},onClick:()=>i(t),children:(0,s.jsx)("img",{className:"w-5 inline-block leading-5 pb-[4px] hover:shadow-2xl shadow-white",src:"https://purecatamphetamine.github.io/country-flag-icons/3x2/".concat(e.flag,".svg"),alt:""})},e.name))})]})})},O=l(9295);let L=e=>{let{conf:t,t:l,step:a,i}=e,[r,o]=(0,n.useState)(!1),[c,d]=(0,n.useState)(!1);return(0,s.jsxs)("div",{children:[l("Step")," ",i+1,": ",(0,s.jsx)("span",{className:"font-bold",children:l(a)})," - ",(0,s.jsx)("span",{className:"underline cursor-pointer",onClick:()=>o(e=>!e),children:l(r?"hide code":"show code")}),t.prompt&&(0,s.jsxs)("span",{children:[", ",(0,s.jsx)("span",{className:"underline mr-2 cursor-pointer",onClick:()=>d(e=>!e),children:l(c?"hide prompt":"show prompt")}),"(",t.model,")"]}),(0,s.jsxs)("div",{children:[r&&(0,s.jsx)("div",{className:"my-4 border rounded p-4 bg-gray-50",children:(0,s.jsx)("pre",{className:"text-xs",children:t.source_code})}),c&&(0,s.jsx)("div",{className:"my-4 border rounded p-4 bg-gray-50",children:(0,s.jsx)("pre",{className:"text-xs whitespace-pre-wrap",children:t.prompt})})]})]},a)},W=e=>{let{manualChanges:t,t:l}=e,[a,i]=(0,n.useState)([]),[r,o]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{i(t)},[]),a.length>0&&(0,s.jsxs)("div",{className:"mt-8",children:[l("Some manual changes were also made to the report"),":"," ",(0,s.jsxs)("span",{className:"underline mr-2 cursor-pointer",onClick:()=>o(e=>!e),children:[l(r?"hide changes":"show changes"),a&&a.length>0&&" (".concat(a.length,")")]}),r&&(0,s.jsx)("ul",{className:"text-left list-outside list-disc ml-6 mt-4",children:a.map((e,t)=>(0,s.jsx)("li",{children:(0,O.NV)(e.from,e.to).map((e,l)=>(0,s.jsxs)("span",{children:[e.added&&(0,s.jsx)("span",{className:"bg-green-200",children:e.value}),e.removed&&(0,s.jsx)("span",{className:"bg-red-200 line-through",children:e.value}),!e.added&&!e.removed&&(0,s.jsx)("span",{children:e.value.length<163?e.value:e.value.slice(0,80)+" ... "+e.value.slice(e.value.length-80)})]},"".concat(t,"/").concat(l)))},t))})]})};var B=e=>{let{config:t,translator:l}=e,{t:n,manualChanges:a}=l;return(0,s.jsxs)("div",{id:"appendix",children:[(0,s.jsx)("hr",{className:"h-px my-8 bg-gray-600 border-0 dark:bg-gray-700"}),(0,s.jsx)("h2",{className:"text-3xl font-bold my-4 border-t-black",children:n("Appendix")}),(0,s.jsxs)("div",{className:"text-left mt-8",children:[n("This report was generated using an AI pipeline that consists of the following steps"),":",(0,s.jsx)("div",{className:"text-left list-outside list-disc ml-6 mt-4",children:["extraction","embedding","clustering","labelling","takeaways","overview"].map((e,l)=>(0,s.jsx)(L,{conf:t[e],t:n,step:e,i:l},l))}),(0,s.jsx)(W,{manualChanges:a,t:n})]})]})};let A=e=>{let{name:t,target:l,small:n}=e,a="opacity-60 hover:opacity-100 cursor-pointer";return n&&(a+=" text-xs ml-2  max-w-xs  line-clamp-1 leading-6"),(0,s.jsx)("h2",{className:a,onClick:()=>{let e=document.getElementById(l);window.scrollTo({top:e.offsetTop-50,behavior:"smooth"})},children:t})};var F=e=>{let{clusters:t,translator:l}=e,{t:n}=l;return(0,s.jsx)("div",{className:"hidden xl:block fixed left-0 top-0 h-full text-left mt-8 opacity-40 hover:opacity-100 leading-10 transition-all",children:(0,s.jsxs)("div",{className:"text-left list-outside list-disc ml-2 mt-4",children:[(0,s.jsx)(A,{name:n("Introduction"),target:"introduction"}),(0,s.jsx)(A,{name:n("Clusters"),target:"clusters"}),t.map((e,t)=>(0,s.jsx)(A,{small:!0,name:n(e.cluster),target:"cluster-"+e.cluster_id},t)),(0,s.jsx)(A,{name:n("Appendix"),target:"appendix"})]})})},V=e=>{let{config:t}=e,l=t.name,n=t.description||t.question,a="GTM-55555555";return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(C(),{children:[(0,s.jsx)("title",{children:l}),(0,s.jsx)("meta",{name:"description",content:n}),a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("script",{async:!0,src:"https://www.googletagmanager.com/gtag/js?id=".concat(a)}),(0,s.jsx)("script",{dangerouslySetInnerHTML:{__html:"\n                window.dataLayer = window.dataLayer || [];\n                function gtag(){dataLayer.push(arguments);}\n                gtag('js', new Date());\n                gtag('config', '".concat(a,"');\n              ")}})]})]})})},D=()=>(0,s.jsxs)("div",{className:"text-left mt-8",children:[(0,s.jsx)("a",{href:"".concat("https://example.com/privacy-policy"),children:"プライバシーポリシー"}),(0,s.jsx)("br",{})]});let Z=e=>{let[t,l]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{l(N())},[]),t?(0,s.jsx)(M,{...e}):(0,s.jsx)(R,{...e})};var G=function(e){let[t,l]=(0,n.useState)(null),{config:a,clusters:r,translations:o,overview:d}=e,u=i(r.map(e=>e.cluster_id)),m=(0,n.useRef)(0),h=c(a,o,r),[x,g]=(0,n.useState)(!1);if((0,n.useEffect)(()=>{g(!0)},[]),!x)return!1;let{t:p}=h,f=r.map(e=>e.arguments.length).reduce((e,t)=>e+t,0);return t?(0,s.jsx)(Z,{...e,color:u,translator:h,back:()=>{l(null),setTimeout(()=>window.scrollTo({top:m.current}),0)},fullScreen:!0,onlyCluster:"main"!==t?t:void 0}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(V,{config:a}),(0,s.jsxs)("div",{className:"mt-9",children:[(0,s.jsx)(F,{clusters:r,translator:h}),(0,s.jsx)(H,{...e,translator:h}),(0,s.jsxs)("div",{className:"text-center max-w-3xl m-auto py-8 px-5",style:{display:t?"none":"block"},children:[(0,s.jsx)("h2",{className:"text-xl my-3 font-bold",children:p(a.name)}),(0,s.jsx)("h1",{className:"text-3xl my-3 mb-10",children:p(a.question)}),(0,s.jsxs)("div",{id:"introduction",className:"my-4",children:[(0,s.jsxs)("div",{id:"big-map",children:[(0,s.jsx)(Z,{...e,translator:h,color:u,width:450,height:450}),(0,s.jsx)("button",{className:"my-2 underline",onClick:()=>{m.current=window.scrollY,l("main")},children:p("Open full-screen map")})]}),(0,s.jsxs)("div",{id:"overview",className:"text-left font-bold my-3",children:[p("Overview"),":"]}),(0,s.jsx)("div",{className:"text-left",children:p(d)})]}),(0,s.jsx)("div",{id:"clusters",children:r.sort((e,t)=>t.arguments.length-e.arguments.length).map(t=>(0,s.jsxs)("div",{id:"cluster-".concat(t.cluster_id),children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold my-2 mt-12",style:{color:u(t.cluster_id)},children:p(t.cluster)}),(0,s.jsxs)("div",{className:"text-lg opacity-50 mb-3",children:["(",t.arguments.length," ",p("arguments"),",",Math.round(100*t.arguments.length/f),"%"," ",p("of total"),")"]}),(0,s.jsxs)("div",{className:"text-left font-bold my-3",children:[p("Cluster analysis"),":"]}),(0,s.jsx)("div",{className:"text-left",children:p(t.takeaways)}),(0,s.jsxs)("div",{className:"my-4",children:[(0,s.jsx)(Z,{...e,translator:h,color:u,width:350,height:350,onlyCluster:p(t.cluster_id)}),(0,s.jsx)("button",{className:"my-2 underline",onClick:()=>{m.current=window.scrollY,l(t.cluster_id)},children:p("Open full-screen map")})]}),(0,s.jsxs)("div",{className:"text-left font-bold my-3",children:[p("Representative comments"),":"]}),(0,s.jsx)("ul",{className:"text-left list-outside list-disc ml-6 ",children:t.arguments.sort((e,t)=>t.p-e.p).slice(0,5).map((e,t)=>(0,s.jsx)("li",{className:"italic",children:p(e.argument)},t))})]},t.cluster_id))}),(0,s.jsx)(B,{config:a,translator:h}),(0,s.jsx)(D,{})]})]})]})}}}]);